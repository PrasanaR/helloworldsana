pipeline {
    agent any
    environment {
        PATH = "/usr/bin:$PATH"
    }
    stages {
        
        stage("Git Code Check - Truffle"){
            steps{
              sh '''
              rm -r trufflehog || true
              docker run gesellix/trufflehog --json https://github.com/PrasanaR/helloworldsana.git > trufflehog.json
              cat trufflehog.json
              '''
            }
        }
         
        stage ('OWASP Dependency-Check Vulnerabilities') {
            steps {
                //dependencyCheck additionalArguments: '''-s "./" -f "XML"''', odcInstallation: 'Dependency-Check'
                dependencyCheck additionalArguments: '''-s "./" -f "XML" -o "./report/"''', odcInstallation: 'Dependency-Check'
            }
        }     
    
        stage('SONAR SAST SCAN')
            steps{
                withSonarQubeEnv {
                sh'mvn sonar:sonar'
                sh'cat /target/sonar/report-task.txt'
              }

            }
            
       
        
        stage("build code"){
            steps{
              sh "mvn clean package"
            }
        }
        stage("deploy"){
            steps{
              
                 sh "mv webapp/target/webapp.war /opt/tomcat/latest/webapps/webapp.war"
                
            }
        }
    }
}
